<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &#8212; pyqha 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="pyqha 0.1 documentation" href="index.html" />
    <link rel="next" title="pyqha package" href="pyqha.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><h1 style="font-size: 3em;">pyqha</h1></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pyqha.html" title="pyqha package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#fitting-the-total-energy-examples-1-and-2">Fitting the total energy (examples 1 and 2)</a></li>
<li><a class="reference internal" href="#computing-thermal-properties-from-phonon-dos-examples-3-and-4">Computing thermal properties from phonon DOS (examples 3 and 4)</a></li>
<li><a class="reference internal" href="#computing-quasi-harmonic-properties-examples-5-and-6">Computing quasi-harmonic properties (examples 5 and 6)</a></li>
<li><a class="reference internal" href="#computing-quasi-static-elastic-constants-example-7">Computing quasi-static elastic constants (example 7)</a></li>
<li><a class="reference internal" href="#numerical-issues-example-8">Numerical issues (example 8)</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pyqha.html"
                        title="next chapter">pyqha package</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This is a simple tutorial demonstrating the main functionalities of <code class="xref py py-mod docutils literal"><span class="pre">pyqha</span></code>. The examples below show how to use the package to perform the most common tasks. The code examples can be found in the directory <em>examples</em> of the package and can be run either as interactive sessions in your Python intepreter or as scripts.
The tutorial is based on the following examples:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Example n.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Fit <img class="math" src="_images/math/1b43a9b9fc946c5e4302c3dd56be1b79358f3d66.png" alt="E_{tot}(V)"/> for a cubic (isotropic) system using Murnaghan EOS</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Fit <img class="math" src="_images/math/803ec8c4fe48db38a1a75458ad3afadf2d78cfba.png" alt="E_{tot}(a,c)"/> for an hexagonal (anisotropic) system  using a polynomial</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Calculate the harmonic thermodynamic properties (ZPE, vibrational energy, Helmholtz energy, entropy and heat capacity from a phonon DOS</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Calculate the harmonic thermodynamic properties as in the previous examples from several phonon DOS</td>
</tr>
<tr class="row-even"><td>5</td>
<td>A quasi-harmonic calculation for a cubic (isotropic) system using Murnaghan EOS</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>A quasi-harmonic calculation for an hexagonal (anisotropic) system  using a quadratic polynomial</td>
</tr>
<tr class="row-even"><td>7</td>
<td>A quasi-static calculation for the elastic tensor of an hexagonal (anisotropic) system  using a quadratic polynomial</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>Numerical issues in quasi-harmonic calculations</td>
</tr>
</tbody>
</table>
<p>Several simplified plotting functions are available in <code class="xref py py-mod docutils literal"><span class="pre">pyqha</span></code> and are used in the following tutorial to show what you can plot.
Note however that all plotting functions need the matplotlib library, which must be available on your system and can be used to further taylor your plot.</p>
<div class="section" id="fitting-the-total-energy-examples-1-and-2">
<h2>Fitting the total energy (examples 1 and 2)<a class="headerlink" href="#fitting-the-total-energy-examples-1-and-2" title="Permalink to this headline">¶</a></h2>
<p>The simplest task you can do with <code class="xref py py-mod docutils literal"><span class="pre">pyqha</span></code> is to fit the total energy as a function of volume <img class="math" src="_images/math/1b43a9b9fc946c5e4302c3dd56be1b79358f3d66.png" alt="E_{tot}(V)"/> (example1) or lattice parameters values <img class="math" src="_images/math/714ef93f09131800efab946b4c3db57dee626f49.png" alt="E_{tot}(a,b,c,\alpha,\beta,\gamma)"/> (example2). In the former case, you can use
an equation of state (EOS) such as Murnaghan&#8217;s or similar. In the latter case, you must use polynomials. Currently the Murnaghan EOS and quadratic and quartic polynomials are implemented in <code class="xref py py-mod docutils literal"><span class="pre">pyqha</span></code>. Besides, only <img class="math" src="_images/math/17a34eda712275d70c3c83bb21a37a9525793514.png" alt="a,b,c"/> lattice parameters can be handled. This includes cubic, hexagonal, tetragonal and orthorombic systems.</p>
<p>Let&#8217;s start with the simpler case where we want to fit <img class="math" src="_images/math/1b43a9b9fc946c5e4302c3dd56be1b79358f3d66.png" alt="E_{tot}(V)"/>. This is the case of isotropic cubic systems (simple cubic, body centered cubic, face centered cubic) or systems which can be approximated as isotropic (for example an hexagonal system with nearly constant <img class="math" src="_images/math/9fa4452dc245d05063a16616298982281f834559.png" alt="c/a"/> ratio).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">fitEtotV</span><span class="p">,</span> <span class="n">plot_EV</span>

<span class="n">fin</span> <span class="o">=</span> <span class="s2">&quot;./EtotV.dat&quot;</span>  		<span class="c1"># file with the total energy data E(V)</span>
<span class="n">V</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">chi2</span> <span class="o">=</span> <span class="n">fitEtotV</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>    	<span class="c1"># fits the E(V) data, returns the coefficients a and</span>
                                	<span class="c1"># the chi squared chi2</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">plot_EV</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>                  	<span class="c1"># plot the E(V) data and the fitting line</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_1.png&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>The <code class="xref py py-func docutils literal"><span class="pre">fitEtotV()</span></code> needs in input a file with two columns: the first with the volumes (in <img class="math" src="_images/math/2992e67f1f6a95b9e595c21733afd4498b8aa5b8.png" alt="a.u.^3"/>), the second with energies (in <img class="math" src="_images/math/f66ef80fce797aaa395a5db0d9139dc35c1c6b41.png" alt="Ryd/cell"/>). It returns the volumes <em>V</em> and energies <em>E</em> from the input file plus the fitting coefficients <em>a</em> and the <img class="math" src="_images/math/b0a677c7b64a9ce46bca897eabaf2af1c84de1a5.png" alt="\chi^2"/> <em>chi</em>. The fitting results are also written in details on the <em>stdout</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Murnaghan EOS 		 chi squared= 6.3052568895e-09</span>
<span class="c1"># Etotmin= -1.6668753460e+03 Ry	 Vmin= 1.9256061524e+02 a.u.^3	 B0= 3.9507615923e+03 kbar	 dB0/dV= 4.7879823925e+00</span>
<span class="c1">################################################################################</span>
<span class="p">(</span><span class="s1">&#39;# V *a.u.^3)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Etot&#39;</span><span class="p">,</span> <span class="s1">&#39; (Ry)</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Etotfit&#39;</span><span class="p">,</span> <span class="s1">&#39; (Ry)</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Etot-Etotfit (Ry)</span><span class="se">\t</span><span class="s1">P (kbar)&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;1.7119697047e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668351807e+03</span><span class="se">\t</span><span class="s1"> -1.6668351587e+03</span><span class="se">\t</span><span class="s1"> -2.2057946126e-05</span><span class="se">\t</span><span class="s1"> 6.2382144794e+02&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;1.7637989181e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668536038e+03</span><span class="se">\t</span><span class="s1"> -1.6668536431e+03</span><span class="se">\t</span><span class="s1"> 3.9279193061e-05</span><span class="se">\t</span><span class="s1"> 4.3100002530e+02&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;1.8166637877e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668660570e+03</span><span class="se">\t</span><span class="s1"> -1.6668660710e+03</span><span class="se">\t</span><span class="s1"> 1.4066826679e-05</span><span class="se">\t</span><span class="s1"> 2.6537032641e+02&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;1.8705745588e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668731355e+03</span><span class="se">\t</span><span class="s1"> -1.6668731118e+03</span><span class="se">\t</span><span class="s1"> -2.3774691499e-05</span><span class="se">\t</span><span class="s1"> 1.2288570223e+02&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;1.9255414767e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668753764e+03</span><span class="se">\t</span><span class="s1"> -1.6668753460e+03</span><span class="se">\t</span><span class="s1"> -3.0400133255e-05</span><span class="se">\t</span><span class="s1"> 1.3270797876e-01&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;1.9815747866e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668732871e+03</span><span class="se">\t</span><span class="s1"> -1.6668732783e+03</span><span class="se">\t</span><span class="s1"> -8.8363487976e-06</span><span class="se">\t</span><span class="s1"> -1.0577273936e+02&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;2.0386847338e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668673220e+03</span><span class="se">\t</span><span class="s1"> -1.6668673472e+03</span><span class="se">\t</span><span class="s1"> 2.5137771445e-05</span><span class="se">\t</span><span class="s1"> -1.9727140701e+02&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;2.0968815635e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668579007e+03</span><span class="se">\t</span><span class="s1"> -1.6668579345e+03</span><span class="se">\t</span><span class="s1"> 3.3763105193e-05</span><span class="se">\t</span><span class="s1"> -2.7643217490e+02&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;2.1561755211e+02&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-1.6668454001e+03</span><span class="se">\t</span><span class="s1"> -1.6668453730e+03</span><span class="se">\t</span><span class="s1"> -2.7177809670e-05</span><span class="se">\t</span><span class="s1"> -3.4501143525e+02&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Optionally, you can plot the results with the <code class="xref py py-func docutils literal"><span class="pre">plot_EV()</span></code>. The original data are represented as points. If <em>a!=None</em>, a line with the fitting EOS will also be plotted. The output plot looks like the following:</p>
<a class="reference internal image-reference" href="_images/figure_1.png"><img alt="_images/figure_1.png" src="_images/figure_1.png" style="width: 500px;" /></a>
<p>The second example shows how to fit the total energy of an hexagonal system, i.e. as a function of the lattice parameters <img class="math" src="_images/math/4fd6d1eaa5bdfc2402c9cd652cb8418d6a851858.png" alt="(a,c)"/>. The input file (<em>fin</em>) contains three columns, the first two with the <img class="math" src="_images/math/4fd6d1eaa5bdfc2402c9cd652cb8418d6a851858.png" alt="(a,c)"/> (in <img class="math" src="_images/math/d935fd0b17b6d0138bea48d11efd237fba1a7468.png" alt="a.u."/>) and the third one with the energies (in <img class="math" src="_images/math/f66ef80fce797aaa395a5db0d9139dc35c1c6b41.png" alt="Ryd/cell"/>). Note that if the original data are as <img class="math" src="_images/math/6130a4747ee1e1e0fbf80e6c6ebfeaf31c81a637.png" alt="(a,c/a)"/>, as often reported, you must convert the <img class="math" src="_images/math/9fa4452dc245d05063a16616298982281f834559.png" alt="c/a"/> values into <img class="math" src="_images/math/ae12a24f88803b5895632e4848d87d46483c492c.png" alt="c"/> values in the input file.
The <code class="xref py py-func docutils literal"><span class="pre">fitEtot()</span></code> reads the input file and performs the fit using either a quadratic or quartic polynomial (as specified by the parameter <em>fitype</em>).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>
<span class="n">fin</span> <span class="o">=</span> <span class="s2">&quot;./Etot.dat&quot;</span>  	<span class="c1"># contains the input energies</span>

<span class="c1"># fits the energies and returns the coeffients a0 and the chi squared chia0</span>
<span class="c1"># the fit is done with a quartic polynomial</span>
<span class="n">celldmsx</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">chia0</span><span class="p">,</span> <span class="n">mincelldms</span><span class="p">,</span> <span class="n">fmin</span> <span class="o">=</span> <span class="n">fitEtot</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">guess</span><span class="o">=</span><span class="p">[</span><span class="mf">5.12374914</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">8.19314311</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>

<span class="c1"># 3D plot only with fitted energy</span>
<span class="n">fig1</span> <span class="o">=</span> <span class="n">plot_Etot</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">Ex</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a0</span><span class="p">)</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_1.png&quot;</span><span class="p">)</span>
<span class="c1"># 3D plot fitted energy and points</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">plot_Etot</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">Ex</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a0</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_2.png&quot;</span><span class="p">)</span>
<span class="c1"># 2D contour plot with fitted energy </span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">plot_Etot_contour</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a0</span><span class="p">)</span>
<span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_3.png&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>The output of the fitting function is:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>quartic fit
(&#39;a&#39;, &#39;\t\t\t&#39;, &#39;c&#39;, &#39;\t\t\t&#39;, &#39;Etot&#39;, &#39;\t\t\t&#39;, &#39;Etotfit&#39;, &#39;\t\t\t&#39;, &#39;Etot-Etotfit&#39;)
(&#39;5.1043155930e+00&#39;, &#39;\t&#39;, &#39;7.8471807981e+00&#39;, &#39;\t&#39;, &#39;-1.6668528744e+03&#39;, &#39;\t&#39;, &#39;-1.6668528745e+03&#39;, &#39;\t&#39;, &#39;7.0725036494e-08&#39;)
(&#39;5.1543155930e+00&#39;, &#39;\t&#39;, &#39;7.9240488978e+00&#39;, &#39;\t&#39;, &#39;-1.6668649001e+03&#39;, &#39;\t&#39;, &#39;-1.6668649002e+03&#39;, &#39;\t&#39;, &#39;9.8750206234e-08&#39;)
(&#39;5.2043155930e+00&#39;, &#39;\t&#39;, &#39;8.0009169975e+00&#39;, &#39;\t&#39;, &#39;-1.6668716783e+03&#39;, &#39;\t&#39;, &#39;-1.6668716776e+03&#39;, &#39;\t&#39;, &#39;-7.7131721810e-07&#39;)
(&#39;5.2543155930e+00&#39;, &#39;\t&#39;, &#39;8.0777850972e+00&#39;, &#39;\t&#39;, &#39;-1.6668737355e+03&#39;, &#39;\t&#39;, &#39;-1.6668737365e+03&#39;, &#39;\t&#39;, &#39;9.2776986094e-07&#39;)
(&#39;5.3043155930e+00&#39;, &#39;\t&#39;, &#39;8.1546531969e+00&#39;, &#39;\t&#39;, &#39;-1.6668715550e+03&#39;, &#39;\t&#39;, &#39;-1.6668715547e+03&#39;, &#39;\t&#39;, &#39;-3.2629236557e-07&#39;)
(&#39;5.1043155930e+00&#39;, &#39;\t&#39;, &#39;7.9492671099e+00&#39;, &#39;\t&#39;, &#39;-1.6668606004e+03&#39;, &#39;\t&#39;, &#39;-1.6668606001e+03&#39;, &#39;\t&#39;, &#39;-2.1225582714e-07&#39;)
(&#39;5.1543155930e+00&#39;, &#39;\t&#39;, &#39;8.0271352096e+00&#39;, &#39;\t&#39;, &#39;-1.6668700587e+03&#39;, &#39;\t&#39;, &#39;-1.6668700591e+03&#39;, &#39;\t&#39;, &#39;3.0630963010e-07&#39;)
(&#39;5.2043155930e+00&#39;, &#39;\t&#39;, &#39;8.1050033093e+00&#39;, &#39;\t&#39;, &#39;-1.6668744794e+03&#39;, &#39;\t&#39;, &#39;-1.6668744800e+03&#39;, &#39;\t&#39;, &#39;6.7416499405e-07&#39;)
(&#39;5.2543155930e+00&#39;, &#39;\t&#39;, &#39;8.1828714090e+00&#39;, &#39;\t&#39;, &#39;-1.6668743826e+03&#39;, &#39;\t&#39;, &#39;-1.6668743814e+03&#39;, &#39;\t&#39;, &#39;-1.2613072613e-06&#39;)
(&#39;5.3043155930e+00&#39;, &#39;\t&#39;, &#39;8.2607395087e+00&#39;, &#39;\t&#39;, &#39;-1.6668702280e+03&#39;, &#39;\t&#39;, &#39;-1.6668702285e+03&#39;, &#39;\t&#39;, &#39;4.9947925618e-07&#39;)
(&#39;5.1043155930e+00&#39;, &#39;\t&#39;, &#39;8.0513534218e+00&#39;, &#39;\t&#39;, &#39;-1.6668660570e+03&#39;, &#39;\t&#39;, &#39;-1.6668660572e+03&#39;, &#39;\t&#39;, &#39;2.5535950954e-07&#39;)
(&#39;5.1543155930e+00&#39;, &#39;\t&#39;, &#39;8.1302215215e+00&#39;, &#39;\t&#39;, &#39;-1.6668731355e+03&#39;, &#39;\t&#39;, &#39;-1.6668731348e+03&#39;, &#39;\t&#39;, &#39;-7.0765509008e-07&#39;)
(&#39;5.2043155930e+00&#39;, &#39;\t&#39;, &#39;8.2090896212e+00&#39;, &#39;\t&#39;, &#39;-1.6668753764e+03&#39;, &#39;\t&#39;, &#39;-1.6668753765e+03&#39;, &#39;\t&#39;, &#39;1.0862777344e-08&#39;)
(&#39;5.2543155930e+00&#39;, &#39;\t&#39;, &#39;8.2879577209e+00&#39;, &#39;\t&#39;, &#39;-1.6668732871e+03&#39;, &#39;\t&#39;, &#39;-1.6668732880e+03&#39;, &#39;\t&#39;, &#39;8.4404246081e-07&#39;)
(&#39;5.3043155930e+00&#39;, &#39;\t&#39;, &#39;8.3668258206e+00&#39;, &#39;\t&#39;, &#39;-1.6668673220e+03&#39;, &#39;\t&#39;, &#39;-1.6668673216e+03&#39;, &#39;\t&#39;, &#39;-4.0985673877e-07&#39;)
(&#39;5.1043155930e+00&#39;, &#39;\t&#39;, &#39;8.1534397336e+00&#39;, &#39;\t&#39;, &#39;-1.6668694343e+03&#39;, &#39;\t&#39;, &#39;-1.6668694339e+03&#39;, &#39;\t&#39;, &#39;-4.5153024075e-07&#39;)
(&#39;5.1543155930e+00&#39;, &#39;\t&#39;, &#39;8.2333078333e+00&#39;, &#39;\t&#39;, &#39;-1.6668743061e+03&#39;, &#39;\t&#39;, &#39;-1.6668743073e+03&#39;, &#39;\t&#39;, &#39;1.2780792531e-06&#39;)
(&#39;5.2043155930e+00&#39;, &#39;\t&#39;, &#39;8.3131759330e+00&#39;, &#39;\t&#39;, &#39;-1.6668745384e+03&#39;, &#39;\t&#39;, &#39;-1.6668745377e+03&#39;, &#39;\t&#39;, &#39;-7.0226747084e-07&#39;)
(&#39;5.2543155930e+00&#39;, &#39;\t&#39;, &#39;8.3930440327e+00&#39;, &#39;\t&#39;, &#39;-1.6668706178e+03&#39;, &#39;\t&#39;, &#39;-1.6668706173e+03&#39;, &#39;\t&#39;, &#39;-4.6083209782e-07&#39;)
(&#39;5.3043155930e+00&#39;, &#39;\t&#39;, &#39;8.4729121324e+00&#39;, &#39;\t&#39;, &#39;-1.6668629842e+03&#39;, &#39;\t&#39;, &#39;-1.6668629845e+03&#39;, &#39;\t&#39;, &#39;3.4305685404e-07&#39;)
(&#39;5.1043155930e+00&#39;, &#39;\t&#39;, &#39;8.2555260455e+00&#39;, &#39;\t&#39;, &#39;-1.6668709188e+03&#39;, &#39;\t&#39;, &#39;-1.6668709191e+03&#39;, &#39;\t&#39;, &#39;3.3864898796e-07&#39;)
(&#39;5.1543155930e+00&#39;, &#39;\t&#39;, &#39;8.3363941452e+00&#39;, &#39;\t&#39;, &#39;-1.6668737584e+03&#39;, &#39;\t&#39;, &#39;-1.6668737574e+03&#39;, &#39;\t&#39;, &#39;-9.7452812042e-07&#39;)
(&#39;5.2043155930e+00&#39;, &#39;\t&#39;, &#39;8.4172622449e+00&#39;, &#39;\t&#39;, &#39;-1.6668721346e+03&#39;, &#39;\t&#39;, &#39;-1.6668721354e+03&#39;, &#39;\t&#39;, &#39;7.8953144111e-07&#39;)
(&#39;5.2543155930e+00&#39;, &#39;\t&#39;, &#39;8.4981303446e+00&#39;, &#39;\t&#39;, &#39;-1.6668665315e+03&#39;, &#39;\t&#39;, &#39;-1.6668665315e+03&#39;, &#39;\t&#39;, &#39;-4.8681386033e-08&#39;)
(&#39;5.3043155930e+00&#39;, &#39;\t&#39;, &#39;8.5789984443e+00&#39;, &#39;\t&#39;, &#39;-1.6668573689e+03&#39;, &#39;\t&#39;, &#39;-1.6668573688e+03&#39;, &#39;\t&#39;, &#39;-1.0538019524e-07&#39;)

Fitted polynomial is: 

p(x1,x2) = -1291.10429456 + -184.969221276 * x1 + 42.2676103527 * x1^2 + -4.81052197937 * x1^3 + 0.188178329491 * x1^4 +
-49.1590620388 *x2 + 5.34145510286 *x2^2 + -0.245662970361 *x2^3 + -0.000328650634003 *x2^4 +
8.48734670683 *x1*x2 + -0.67806386411 *x1*x2^2 + 0.0444127765503 *x1*x2^3 + -0.393401452901 *x1^2*x2 + -0.0458527834065 *x1^2*x2^2 +
0.0705006802514 *x1^3*x2

(&#39;Chi squared: &#39;, 9.8189738184091843e-12, &#39;\n&#39;)
(&#39;Minimun quartic: &#39;, array([ 5.20422334,  0.        ,  8.20918742,  0.        ,  0.        ,  0.        ]), &#39;\tEnergy at the minimum: -1.66687537646402097380e+03\n&#39;)
</pre></div>
</div>
<p>Optionally, you can use the functions <code class="xref py py-func docutils literal"><span class="pre">plot_Etot()</span></code>, <code class="xref py py-func docutils literal"><span class="pre">plot_Etot_contour()</span></code> to create 3D or contour plots of the fitted energy over the grid <img class="math" src="_images/math/4fd6d1eaa5bdfc2402c9cd652cb8418d6a851858.png" alt="(a,c)"/>, including or not the original energy points:</p>
<a class="reference internal image-reference" href="_images/figure_11.png"><img alt="_images/figure_11.png" src="_images/figure_11.png" style="width: 500px;" /></a>
<a class="reference internal image-reference" href="_images/figure_2.png"><img alt="_images/figure_2.png" src="_images/figure_2.png" style="width: 500px;" /></a>
<a class="reference internal image-reference" href="_images/figure_3.png"><img alt="_images/figure_3.png" src="_images/figure_3.png" style="width: 500px;" /></a>
</div>
<div class="section" id="computing-thermal-properties-from-phonon-dos-examples-3-and-4">
<h2>Computing thermal properties from phonon DOS (examples 3 and 4)<a class="headerlink" href="#computing-thermal-properties-from-phonon-dos-examples-3-and-4" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-mod docutils literal"><span class="pre">pyqha</span></code> can calculate the vibrational properties of your system from the phonon DOS in the harmonic approximation as shown in <em>example3</em>. The DOS file must be a two columns one, the first column being the energy (in <img class="math" src="_images/math/f66ef80fce797aaa395a5db0d9139dc35c1c6b41.png" alt="Ryd/cell"/>) and the second column being the density of states (in <img class="math" src="_images/math/96d947a513dbf196cf7b51c758f8672de4bd63b0.png" alt="(Ryd/cell)^{-1}"/>).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>
<span class="n">fin</span> <span class="o">=</span> <span class="s2">&quot;./dos.dat&quot;</span>
<span class="n">fout</span> <span class="o">=</span> <span class="s2">&quot;./thermo&quot;</span>  

<span class="n">TT</span> <span class="o">=</span> <span class="n">gen_TT</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>	<span class="c1"># create a numpy array of temperatures from 1 to 1000 step 0.5</span>

<span class="n">E</span><span class="p">,</span> <span class="n">dos</span> <span class="o">=</span> <span class="n">read_dos</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>	<span class="c1"># read the dos file. It returns the energies and dos values.</span>


<span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">ZPE</span><span class="p">,</span> <span class="n">modes</span> <span class="o">=</span> <span class="n">compute_thermo</span><span class="p">(</span><span class="n">E</span><span class="o">/</span><span class="n">RY_TO_CMM1</span><span class="p">,</span><span class="n">dos</span><span class="o">*</span><span class="n">RY_TO_CMM1</span><span class="p">,</span><span class="n">TT</span><span class="p">)</span>
<span class="n">write_thermo</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span><span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span><span class="p">,</span> <span class="n">ZPE</span><span class="p">,</span> <span class="n">modes</span><span class="p">)</span>  

<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">simple_plot_xy</span><span class="p">,</span> <span class="n">multiple_plot_xy</span>
<span class="c1"># plot the original phonon DOS</span>
<span class="n">fig1</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">dos</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;E (Ryd/cell)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;phonon DOS (Ry/cell)^{-1}&quot;</span><span class="p">)</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_1.png&quot;</span><span class="p">)</span>
<span class="c1"># create several plots for the thermodynamic quantities computed</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">Evib</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Evib (Ry/cell)&quot;</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_2.png&quot;</span><span class="p">)</span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">Fvib</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Fvib (Ry/cell)&quot;</span><span class="p">)</span>
<span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_3.png&quot;</span><span class="p">)</span>
<span class="n">fig4</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">Svib</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Svib (Ry/cell/K)&quot;</span><span class="p">)</span>
<span class="n">fig4</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_4.png&quot;</span><span class="p">)</span>
<span class="n">fig5</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">Cvib</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cvib (Ry/cell/K)&quot;</span><span class="p">)</span>
<span class="n">fig5</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_5.png&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>The output produced by the function <code class="xref py py-func docutils literal"><span class="pre">compute_thermo()</span></code> is stored in the variables <em>T, Evib, Svib, Cvib, Fvib, ZPE, modes</em> and can be written in a file using the function <code class="xref py py-func docutils literal"><span class="pre">write_thermo()</span></code>. This output file is as:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># total modes from dos = 5.9999726114e+00
# ZPE = 5.6214272319e-03 Ry/cell
# Multiply by 13.6058 to have energies in eV/cell etc..
# Multiply by 13.6058 x 23060.35 = 313 754.5 to have energies in cal/(N mol).
# Multiply by 13.6058 x 96526.0 = 1 313 313 to have energies in J/(N mol).
# N is the number of formula units per cell.
#
# T (K) 	Evib (Ry/cell)	Fvib (Ry/cell)	Svib (Ry/cell/K)	Cvib (Ry/cell/K)
1.0000000000e+00	5.6214272416e-03	5.6214271698e-03	7.1803604634e-11	2.7457378670e-11
1.5000000000e+00	5.6214272660e-03	5.6214271296e-03	9.0971071082e-11	7.6156598111e-11
2.0000000000e+00	5.6214273247e-03	5.6214270765e-03	1.2411743622e-10	1.6670823649e-10
2.5000000000e+00	5.6214274420e-03	5.6214270023e-03	1.7586528823e-10	3.1294495785e-10
3.0000000000e+00	5.6214276492e-03	5.6214268967e-03	2.5083680991e-10	5.2875068522e-10
3.5000000000e+00	5.6214279847e-03	5.6214267469e-03	3.5365843213e-10	8.2803005242e-10
4.0000000000e+00	5.6214284935e-03	5.6214265377e-03	4.8896152188e-10	1.2247123119e-09
4.5000000000e+00	5.6214292279e-03	5.6214262517e-03	6.6138346588e-10	1.7327611278e-09
5.0000000000e+00	5.6214302472e-03	5.6214258693e-03	8.7556952905e-10	2.3661903162e-09
5.5000000000e+00	5.6214316174e-03	5.6214253684e-03	1.1361755892e-09	3.1390850039e-09
6.0000000000e+00	5.6214334118e-03	5.6214247246e-03	1.4478717445e-09	4.0656278651e-09
6.5000000000e+00	5.6214357110e-03	5.6214239112e-03	1.8153467817e-09	5.1601305330e-09
7.0000000000e+00	5.6214386024e-03	5.6214228992e-03	2.2433135214e-09	6.4370706688e-09
7.5000000000e+00	5.6214421809e-03	5.6214216571e-03	2.7365150966e-09	7.9111356177e-09
8.0000000000e+00	5.6214465489e-03	5.6214201510e-03	3.2997322753e-09	9.5972742802e-09
8.5000000000e+00	5.6214518161e-03	5.6214183448e-03	3.9377920199e-09	1.1510759902e-08
9.0000000000e+00	5.6214581001e-03	5.6214161999e-03	4.6555775947e-09	1.3667267917e-08
9.5000000000e+00	5.6214655265e-03	5.6214136752e-03	5.4580406777e-09	1.6082974484e-08
1.0000000000e+01	5.6214742291e-03	5.6214107269e-03	6.3502160901e-09	1.8774682469e-08
1.0500000000e+01	5.6214843502e-03	5.6214073091e-03	7.3372398855e-09	2.1759981704e-08
1.1000000000e+01	5.6214960411e-03	5.6214033730e-03	8.4243715943e-09	2.5057449144e-08
1.1500000000e+01	5.6215094629e-03	5.6213988672e-03	9.6170213626e-09	2.8686891747e-08
1.2000000000e+01	5.6215247869e-03	5.6213937375e-03	1.0920782549e-08	3.2669631041e-08
1.2500000000e+01	5.6215421953e-03	5.6213879269e-03	1.2341470051e-08	3.7028823823e-08
1.3000000000e+01	5.6215618826e-03	5.6213813755e-03	1.3885164240e-08	4.1789809033e-08
1.3500000000e+01	5.6215840567e-03	5.6213740202e-03	1.5558259988e-08	4.6980467173e-08
1.4000000000e+01	5.6216089398e-03	5.6213657946e-03	1.7367519841e-08	5.2631576208e-08
1.4500000000e+01	5.6216367707e-03	5.6213566288e-03	1.9320130039e-08	5.8777146866e-08
1.5000000000e+01	5.6216678056e-03	5.6213464493e-03	2.1423757831e-08	6.5454720686e-08
1.5500000000e+01	5.6217023209e-03	5.6213351785e-03	2.3686608350e-08	7.2705615875e-08
1.6000000000e+01	5.6217406143e-03	5.6213227346e-03	2.6117479280e-08	8.0575108690e-08
1.6500000000e+01	5.6217830073e-03	5.6213090314e-03	2.8725811574e-08	8.9112541358e-08
</pre></div>
</div>
<p>The first line is the simple integral of the input dos. It must be approximately equal to <img class="math" src="_images/math/f7d9b3b3c40b2b022514a0bbf3db4548b160b13d.png" alt="3N"/>, where <em>N</em> is the number of atoms in the cell. In the present case (h.c.p. Os) it is equal to 6. The second line shows the Zero Point Energy (ZPE). After a few comments lines, the vibrational energy (Evib), Helmholtz energy (Fvib), entropy (Svib) and heat capacity (Cvib) are written as a function of temperature. All quantities are calculated in the harmonic approximation, i.e. for fixed volume (and lattice parameters).</p>
<p>The original dos is plotted as:</p>
<a class="reference internal image-reference" href="_images/figure_12.png"><img alt="_images/figure_12.png" src="_images/figure_12.png" style="width: 500px;" /></a>
<p>The calculated thermodynaminc functions are plotted as:</p>
<a class="reference internal image-reference" href="_images/figure_21.png"><img alt="_images/figure_21.png" src="_images/figure_21.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_31.png"><img alt="_images/figure_31.png" src="_images/figure_31.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_4.png"><img alt="_images/figure_4.png" src="_images/figure_4.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_5.png"><img alt="_images/figure_5.png" src="_images/figure_5.png" style="width: 400px;" /></a>
<p>The following code (example4) shows how multiple dos files can be handled, a step which is preliminary to a quasi-harmonic calculation. The dos are for different volumes (for hexagonal Os).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">gen_TT</span><span class="p">,</span> <span class="n">read_dos_geo</span><span class="p">,</span> <span class="n">compute_thermo_geo</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">simple_plot_xy</span><span class="p">,</span> <span class="n">multiple_plot_xy</span>

<span class="n">fin</span> <span class="o">=</span> <span class="s2">&quot;dos_files/output_dos.dat.g&quot;</span>	<span class="c1"># base name for the dos files (numbers will be added as postfix)</span>
<span class="n">fout</span> <span class="o">=</span> <span class="s2">&quot;thermo&quot;</span>		<span class="c1"># base name for the output files (numbers will be added as postfix)</span>

<span class="n">ngeo</span> <span class="o">=</span> <span class="mi">9</span>				

<span class="n">gE</span><span class="p">,</span> <span class="n">gdos</span> <span class="o">=</span> <span class="n">read_dos_geo</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span><span class="n">ngeo</span><span class="p">)</span> 	<span class="c1"># read ngeo=9 dos files</span>


<span class="c1"># plot the first 5 phonon dos    </span>
<span class="n">fig1</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">gE</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="n">gdos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;E (Ryd/cell)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;phonon DOS (cell/Ryd)&quot;</span><span class="p">)</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_1.png&quot;</span><span class="p">)</span>

<span class="n">TT</span> <span class="o">=</span><span class="n">gen_TT</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>	<span class="c1"># generate the numpy array of temperatures for which the properties will be calculated</span>

<span class="c1"># compute the thermodynamic properties for all ngeo dos files and write them in fout+&quot;i&quot; files, where is an int from 1 to ngeo</span>
<span class="n">T</span><span class="p">,</span> <span class="n">ggEvib</span><span class="p">,</span> <span class="n">ggFvib</span><span class="p">,</span> <span class="n">ggSvib</span><span class="p">,</span> <span class="n">ggCvib</span><span class="p">,</span> <span class="n">ggZPE</span><span class="p">,</span> <span class="n">ggmodes</span> <span class="o">=</span> <span class="n">compute_thermo_geo</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span><span class="n">fout</span><span class="p">,</span><span class="n">ngeo</span><span class="p">,</span><span class="n">TT</span><span class="p">)</span>

<span class="c1"># plot the vibrational Helmholtz energy for the first 5 phonon dos    </span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">ggFvib</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cvib (Ry/cell/K&quot;</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_2.png&quot;</span><span class="p">)</span>

<span class="c1"># plot the vibrational entropy for the first 5 phonon dos    </span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">ggSvib</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cvib (Ry/cell/K&quot;</span><span class="p">)</span>
<span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_3.png&quot;</span><span class="p">)</span>

<span class="c1"># plot the vibrational heat capacity for the first 5 phonon dos    </span>
<span class="n">fig4</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">ggCvib</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cvib (Ry/cell/K&quot;</span><span class="p">)</span>
<span class="n">fig4</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_4.png&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>The first 5 phonon dos are plotted as (color order is: black, red, blue, green, cyan for increasing volumes):</p>
<a class="reference internal image-reference" href="_images/figure_13.png"><img alt="_images/figure_13.png" src="_images/figure_13.png" style="width: 500px;" /></a>
<p>The corresponding vibrational Helmoltz energies, entropies and heat capacity are plotted as:</p>
<a class="reference internal image-reference" href="_images/figure_22.png"><img alt="_images/figure_22.png" src="_images/figure_22.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_32.png"><img alt="_images/figure_32.png" src="_images/figure_32.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_41.png"><img alt="_images/figure_41.png" src="_images/figure_41.png" style="width: 400px;" /></a>
</div>
<div class="section" id="computing-quasi-harmonic-properties-examples-5-and-6">
<h2>Computing quasi-harmonic properties (examples 5 and 6)<a class="headerlink" href="#computing-quasi-harmonic-properties-examples-5-and-6" title="Permalink to this headline">¶</a></h2>
<p>Here we show how to do a full quasi-harmonic calculation starting from the <img class="math" src="_images/math/57afe185b80b23ab0d780bbb9d1f9b2ad3e958f7.png" alt="E_{tot}"/> at 0 K and phonon DOS. First, we show an example using the Murnaghan EOS, having <img class="math" src="_images/math/1b43a9b9fc946c5e4302c3dd56be1b79358f3d66.png" alt="E_{tot}(V)"/> and the corresponding DOS, then using a quartic polynomial on the full grid <img class="math" src="_images/math/4fd6d1eaa5bdfc2402c9cd652cb8418d6a851858.png" alt="(a,c)"/> for an hexagonal cell.</p>
<p>Here is the code in the Murnaghan case:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">RY_KBAR</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">gen_TT</span><span class="p">,</span> <span class="n">read_dos_geo</span><span class="p">,</span> <span class="n">compute_thermo_geo</span><span class="p">,</span> <span class="n">read_thermo</span><span class="p">,</span> <span class="n">rearrange_thermo</span><span class="p">,</span> <span class="n">fitFvibV</span><span class="p">,</span> <span class="n">write_xy</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">simple_plot_xy</span><span class="p">,</span> <span class="n">multiple_plot_xy</span>

<span class="c1"># this part is for calculating the thermodynamic properties from the dos</span>
<span class="n">fdos</span><span class="o">=</span><span class="s2">&quot;dos_files/output_dos.dat.g&quot;</span>	<span class="c1"># base name for the dos files (numbers will be added as postfix)</span>
<span class="n">fthermo</span> <span class="o">=</span> <span class="s2">&quot;thermo&quot;</span>		<span class="c1"># base name for the output files (numbers will be added as postfix)</span>

<span class="n">ngeo</span> <span class="o">=</span> <span class="mi">9</span>	<span class="c1"># this is the number of volumes for which a dos has been calculated			</span>

<span class="n">TT</span> <span class="o">=</span><span class="n">gen_TT</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>	<span class="c1"># generate the numpy array of temperatures for which the properties will be calculated</span>
<span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span><span class="p">,</span> <span class="n">ZPE</span><span class="p">,</span> <span class="n">modes</span> <span class="o">=</span> <span class="n">compute_thermo_geo</span><span class="p">(</span><span class="n">fdos</span><span class="p">,</span><span class="n">fthermo</span><span class="p">,</span><span class="n">ngeo</span><span class="p">,</span><span class="n">TT</span><span class="p">)</span>
<span class="n">nT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>


<span class="c1"># Alternatively, read the thermodynamic data from files, if you have already</span>
<span class="c1"># done the calculations. Uncomment the following 2 lines and delete the previous 3 lines</span>
<span class="c1">#T1, Evib1, Fvib1, Svib1, Cvib1 = read_thermo( fthermo, ngeo )</span>
<span class="c1">#T, T, Evib, Fvib, Svib, Cvib = rearrange_thermo( T1, Evib1, Fvib1, Svib1, Cvib1, ngeo )    </span>


<span class="n">fEtot</span> <span class="o">=</span> <span class="s2">&quot;./Etot.dat&quot;</span>
<span class="n">thermodata</span> <span class="o">=</span> <span class="n">nT</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span> 
<span class="n">TT</span><span class="p">,</span> <span class="n">Fmin</span><span class="p">,</span> <span class="n">Vmin</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">betaT</span><span class="p">,</span> <span class="n">Cv</span><span class="p">,</span> <span class="n">Cp</span><span class="p">,</span> <span class="n">aT</span><span class="p">,</span> <span class="n">chi</span> <span class="o">=</span> <span class="n">fitFvibV</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">)</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">Fmin</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Fmin (Ry/cell)&quot;</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">Vmin</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Vmin (a.u.^3)&quot;</span><span class="p">)</span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">B0</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;B0 (kbar)&quot;</span><span class="p">)</span>
<span class="n">fig4</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">betaT</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
<span class="n">fig5</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">Cp</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cp (Ry/cell/K&quot;</span><span class="p">)</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_1.png&quot;</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_2.png&quot;</span><span class="p">)</span>
<span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_3.png&quot;</span><span class="p">)</span>
<span class="n">fig4</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_4.png&quot;</span><span class="p">)</span>
<span class="n">fig5</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_5.png&quot;</span><span class="p">)</span>    

<span class="c1"># save the results in a file if you want...</span>
<span class="n">write_xy</span><span class="p">(</span><span class="s2">&quot;Fmin.dat&quot;</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">Fmin</span><span class="p">,</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="s2">&quot;Fmin (Ryd/cell)&quot;</span><span class="p">)</span>
<span class="n">write_xy</span><span class="p">(</span><span class="s2">&quot;Vmin.dat&quot;</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">Vmin</span><span class="p">,</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="s2">&quot;Vmin (a.u.^3)&quot;</span><span class="p">)</span>
<span class="n">write_xy</span><span class="p">(</span><span class="s2">&quot;B0.dat&quot;</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">B0</span><span class="o">*</span><span class="n">RY_KBAR</span><span class="p">,</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="s2">&quot;B0 (kbar)&quot;</span><span class="p">)</span>
<span class="n">write_xy</span><span class="p">(</span><span class="s2">&quot;beta.dat&quot;</span><span class="p">,</span><span class="n">T</span><span class="p">,</span> <span class="n">betaT</span><span class="p">,</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="s2">&quot;Beta=1/V dV/dT (1/K)&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">CvCp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
<span class="n">CvCp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cv</span>
<span class="n">CvCp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cp</span>
<span class="n">fig6</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">CvCp</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cv/Cp (Ry/cell/K&quot;</span><span class="p">)</span>
<span class="n">fig6</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_6.png&quot;</span><span class="p">)</span>

<span class="n">print_eos_data</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">E</span><span class="o">+</span><span class="n">Fvib</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">,</span><span class="n">chi</span><span class="p">,</span><span class="s2">&quot;E&quot;</span><span class="p">)</span>  <span class="c1"># print full detail at each T</span>

</pre></div>
</div>
<p>Note from the first line that there are some constants you can import from the module and use for unit conversions. See the documentation for more details on which ones are available.
In this example, 9 volumes are used (ngeo=9). First the harmonic thermodynamic properties are computed as in the previous example. You store these quantities in a list called <em>thermodata</em>. You also need to read the total energies as in example 1 from the file <em>Etot.dat</em>, which is taken care inside the function <code class="xref py py-func docutils literal"><span class="pre">fitEtotV()</span></code>. This is the function which is really doing the quasi-harmonic calculations, i.e. it fits a Murnaghan EOS at each T using <img class="math" src="_images/math/174aa3d7370f21e26a82adeba71760a12acc82f1.png" alt="E_{tot}(V)+F_{vib}(V,T)"/>. It returns <em>TT, Fmin, Vmin, B0, betaT, Cv, Cp</em>, which are all numpy 1D arrays containing the temperatures where the calculations were done and the resulting minimun Helmholtz energy (at each T), minimun volume, isobaric bulk modulus, volume thermal expansion, constant volume and constant pressure heat capacities, respectively. These quantities correspond to <img class="math" src="_images/math/c9261671369425fefd9f29cf951ac739a88e5103.png" alt="P=0"/>.</p>
<p>The following lines show how to plot each quantity on a single plot (using the function <code class="xref py py-func docutils literal"><span class="pre">simple_plot_xy()</span></code>), write the results in files (using the <code class="xref py py-func docutils literal"><span class="pre">write_xy()</span></code>) and plot both <em>Cv</em> and <em>Cp</em> in a single plot (using the function <code class="xref py py-func docutils literal"><span class="pre">multiple_plot_xy()</span></code>).</p>
<p>If everything went well, you should get the following plots:</p>
<a class="reference internal image-reference" href="_images/figure_14.png"><img alt="_images/figure_14.png" src="_images/figure_14.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_23.png"><img alt="_images/figure_23.png" src="_images/figure_23.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_33.png"><img alt="_images/figure_33.png" src="_images/figure_33.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_42.png"><img alt="_images/figure_42.png" src="_images/figure_42.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_51.png"><img alt="_images/figure_51.png" src="_images/figure_51.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_6.png"><img alt="_images/figure_6.png" src="_images/figure_6.png" style="width: 400px;" /></a>
<p>In the following we show the code for a similar example of an hexagonal (anisotropic) system. The code is similar to the previous examples with a few important differences.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">RY_KBAR</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">gen_TT</span><span class="p">,</span> <span class="n">read_Etot</span><span class="p">,</span> <span class="n">read_dos_geo</span><span class="p">,</span> <span class="n">compute_thermo_geo</span><span class="p">,</span> <span class="n">read_thermo</span><span class="p">,</span> <span class="n">rearrange_thermo</span><span class="p">,</span> <span class="n">fitFvib</span><span class="p">,</span> <span class="n">write_celldmsT</span><span class="p">,</span> <span class="n">write_alphaT</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">simple_plot_xy</span><span class="p">,</span> <span class="n">plot_Etot</span><span class="p">,</span> <span class="n">plot_Etot_contour</span>

<span class="c1"># this part is for calculating the thermodynamic properties from the dos</span>
<span class="n">fdos</span><span class="o">=</span><span class="s2">&quot;dos_files/output_dos.dat.g&quot;</span>	<span class="c1"># base name for the dos files (numbers will be added as postfix)</span>
<span class="n">fthermo</span> <span class="o">=</span> <span class="s2">&quot;thermo&quot;</span>		<span class="c1"># base name for the output files (numbers will be added as postfix)</span>

<span class="n">ngeo</span> <span class="o">=</span> <span class="mi">25</span>	<span class="c1"># this is the number of volumes for which a dos has been calculated			</span>

<span class="c1">#TT =gen_TT(1,1000)	# generate the numpy array of temperatures for which the properties will be calculated</span>
<span class="c1">#T, Evib, Fvib, Svib, Cvib, ZPE, modes = compute_thermo_geo(fdos,fthermo,ngeo,TT)</span>
<span class="c1">#nT = len(T)</span>

<span class="c1"># Alternatively, read the thermodynamic data from files if you have already</span>
<span class="c1"># done the calculations</span>
<span class="n">T1</span><span class="p">,</span> <span class="n">Evib1</span><span class="p">,</span> <span class="n">Fvib1</span><span class="p">,</span> <span class="n">Svib1</span><span class="p">,</span> <span class="n">Cvib1</span> <span class="o">=</span> <span class="n">read_thermo</span><span class="p">(</span> <span class="n">fthermo</span><span class="p">,</span> <span class="n">ngeo</span> <span class="p">)</span>
<span class="n">nT</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span> <span class="o">=</span> <span class="n">rearrange_thermo</span><span class="p">(</span> <span class="n">T1</span><span class="p">,</span> <span class="n">Evib1</span><span class="p">,</span> <span class="n">Fvib1</span><span class="p">,</span> <span class="n">Svib1</span><span class="p">,</span> <span class="n">Cvib1</span><span class="p">,</span> <span class="n">ngeo</span> <span class="p">)</span>    


<span class="n">fEtot</span> <span class="o">=</span> <span class="s2">&quot;./Etot.dat&quot;</span>
<span class="n">thermodata</span> <span class="o">=</span> <span class="n">nT</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span> 
<span class="n">TT</span><span class="p">,</span> <span class="n">Fmin</span><span class="p">,</span> <span class="n">celldmsminT</span><span class="p">,</span> <span class="n">alphaT</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">aT</span><span class="p">,</span> <span class="n">chi</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">,</span><span class="n">minoptions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">})</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">Fmin</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Fmin (Ry/cell)&quot;</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">celldmsminT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;a_min (a.u.)&quot;</span><span class="p">)</span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">celldmsminT</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;c_min (a.u.)&quot;</span><span class="p">)</span>
<span class="n">fig4</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">celldmsminT</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">celldmsminT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;c/a &quot;</span><span class="p">)</span>    
<span class="n">fig5</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">alphaT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;alpha_xx (1/K)&quot;</span><span class="p">)</span>
<span class="n">fig6</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">alphaT</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;alpha_zz (1/K)&quot;</span><span class="p">)</span>

<span class="c1"># write a(T) and c(T) on a file</span>
<span class="n">write_celldmsT</span><span class="p">(</span><span class="s2">&quot;celldmminT&quot;</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">celldmsminT</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># write alpha_xx(T) and alpha_zz(T) on a file</span>
<span class="n">write_alphaT</span><span class="p">(</span><span class="s2">&quot;alphaT&quot;</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">alphaT</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Plot several quantities at T=998+1 K as an example</span>
<span class="n">celldmsx</span><span class="p">,</span> <span class="n">Ex</span> <span class="o">=</span> <span class="n">read_Etot</span><span class="p">(</span><span class="n">fEtot</span><span class="p">)</span>  <span class="c1"># since the fitFvib does not return Etot data, you must read them from the original file</span>
<span class="n">iT</span><span class="o">=</span><span class="mi">998</span>                  <span class="c1"># this is the index of the temperatures array, not the temperature itself</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;T= &quot;</span><span class="p">,</span><span class="n">TT</span><span class="p">[</span><span class="n">iT</span><span class="p">],</span><span class="s2">&quot; (K)&quot;</span><span class="p">)</span>
<span class="c1"># 3D plot only with fitted energy (Etot+Fvib)</span>
<span class="n">fig7</span> <span class="o">=</span> <span class="n">plot_Etot</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">Ex</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a0</span><span class="o">+</span><span class="n">aT</span><span class="p">[</span><span class="n">iT</span><span class="p">])</span>
<span class="c1"># 3D plot fitted energy and points</span>
<span class="n">fig8</span> <span class="o">=</span> <span class="n">plot_Etot</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">Ex</span><span class="o">+</span><span class="n">Fvib</span><span class="p">[</span><span class="n">iT</span><span class="p">],</span><span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a0</span><span class="o">+</span><span class="n">aT</span><span class="p">[</span><span class="n">iT</span><span class="p">])</span>
<span class="c1"># 3D plot with fitted energy Fvib only</span>
<span class="n">fig9</span> <span class="o">=</span> <span class="n">plot_Etot</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">Ex</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">aT</span><span class="p">[</span><span class="n">iT</span><span class="p">])</span>
<span class="c1"># 2D contour plot with fitted energy (Etot+Fvib)</span>
<span class="n">fig10</span> <span class="o">=</span> <span class="n">plot_Etot_contour</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a0</span><span class="o">+</span><span class="n">aT</span><span class="p">[</span><span class="n">iT</span><span class="p">])</span>
<span class="c1"># 2D contour plot with fitted energy Fvib only</span>
<span class="n">fig11</span> <span class="o">=</span> <span class="n">plot_Etot_contour</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">aT</span><span class="p">[</span><span class="n">iT</span><span class="p">])</span>   

<span class="c1"># Save all plots</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_1.png&quot;</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_2.png&quot;</span><span class="p">)</span>
<span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_3.png&quot;</span><span class="p">)</span>
<span class="n">fig4</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_4.png&quot;</span><span class="p">)</span>
<span class="n">fig5</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_5.png&quot;</span><span class="p">)</span>    
<span class="n">fig6</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_6.png&quot;</span><span class="p">)</span>      
<span class="n">fig7</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_7.png&quot;</span><span class="p">)</span> 
<span class="n">fig8</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_8.png&quot;</span><span class="p">)</span>
<span class="n">fig9</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_9.png&quot;</span><span class="p">)</span>
<span class="n">fig10</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_10.png&quot;</span><span class="p">)</span>
<span class="n">fig11</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_11.png&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>If everything went well,  you should get the following plots:</p>
<a class="reference internal image-reference" href="_images/figure_15.png"><img alt="_images/figure_15.png" src="_images/figure_15.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_24.png"><img alt="_images/figure_24.png" src="_images/figure_24.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_34.png"><img alt="_images/figure_34.png" src="_images/figure_34.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_43.png"><img alt="_images/figure_43.png" src="_images/figure_43.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_52.png"><img alt="_images/figure_52.png" src="_images/figure_52.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_61.png"><img alt="_images/figure_61.png" src="_images/figure_61.png" style="width: 400px;" /></a>
</div>
<div class="section" id="computing-quasi-static-elastic-constants-example-7">
<h2>Computing quasi-static elastic constants (example 7)<a class="headerlink" href="#computing-quasi-static-elastic-constants-example-7" title="Permalink to this headline">¶</a></h2>
<p>The following code example shows how to do a calculation of a quasi-static elastic tensor as a function of temperature for an hexagonal system. This kind of calculation requires that a quasi-harmonic calculation has already be done (as in example 6). Besides, the elastic constants for different <img class="math" src="_images/math/4fd6d1eaa5bdfc2402c9cd652cb8418d6a851858.png" alt="(a,c)"/> values must be available. To compute these elastic constants you can use for example the thermo_pw code <a class="footnote-reference" href="#thermo-pw" id="id2">[1]</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">RY_KBAR</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">gen_TT</span><span class="p">,</span> <span class="n">read_Etot</span><span class="p">,</span> <span class="n">read_dos_geo</span><span class="p">,</span> <span class="n">compute_thermo_geo</span><span class="p">,</span> <span class="n">read_thermo</span><span class="p">,</span> <span class="n">rearrange_thermo</span><span class="p">,</span> <span class="n">fitFvib</span><span class="p">,</span> <span class="n">write_celldmsT</span><span class="p">,</span> <span class="n">write_alphaT</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">simple_plot_xy</span><span class="p">,</span> <span class="n">multiple_plot_xy</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">read_elastic_constants_geo</span><span class="p">,</span> <span class="n">write_C_geo</span><span class="p">,</span> <span class="n">write_CT</span><span class="p">,</span> <span class="n">rearrange_Cx</span><span class="p">,</span> <span class="n">fitCxx</span><span class="p">,</span> <span class="n">fitCT</span>

<span class="n">fEtot</span> <span class="o">=</span> <span class="s2">&quot;./Etot.dat&quot;</span>
<span class="n">celldmsx</span><span class="p">,</span> <span class="n">Ex</span> <span class="o">=</span> <span class="n">read_Etot</span><span class="p">(</span><span class="n">fEtot</span><span class="p">)</span>  <span class="c1"># since the fitFvib does not return Etot data, you must read them from the original file</span>
    
<span class="c1"># this part is for calculating the thermodynamic properties from the dos</span>
<span class="n">fdos</span><span class="o">=</span><span class="s2">&quot;dos_files/output_dos.dat.g&quot;</span>	<span class="c1"># base name for the dos files (numbers will be added as postfix)</span>
<span class="n">fthermo</span> <span class="o">=</span> <span class="s2">&quot;thermo&quot;</span>		<span class="c1"># base name for the output files (numbers will be added as postfix)</span>

<span class="n">ngeo</span> <span class="o">=</span> <span class="mi">25</span>	<span class="c1"># this is the number of volumes for which a dos has been calculated  </span>

<span class="c1">#TT =gen_TT(1,1000)	# generate the numpy array of temperatures for which the properties will be calculated</span>
<span class="c1">#T, Evib, Fvib, Svib, Cvib, ZPE, modes = compute_thermo_geo(fdos,fthermo,ngeo,TT)</span>
<span class="c1">#nT = len(T)</span>

<span class="c1"># Alternatively, read the thermodynamic data from files if you have already</span>
<span class="c1"># done the calculations</span>
<span class="n">T1</span><span class="p">,</span> <span class="n">Evib1</span><span class="p">,</span> <span class="n">Fvib1</span><span class="p">,</span> <span class="n">Svib1</span><span class="p">,</span> <span class="n">Cvib1</span> <span class="o">=</span> <span class="n">read_thermo</span><span class="p">(</span> <span class="n">fthermo</span><span class="p">,</span> <span class="n">ngeo</span> <span class="p">)</span>
<span class="n">nT</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span> <span class="o">=</span> <span class="n">rearrange_thermo</span><span class="p">(</span> <span class="n">T1</span><span class="p">,</span> <span class="n">Evib1</span><span class="p">,</span> <span class="n">Fvib1</span><span class="p">,</span> <span class="n">Svib1</span><span class="p">,</span> <span class="n">Cvib1</span><span class="p">,</span> <span class="n">ngeo</span> <span class="p">)</span>   

<span class="n">fEtot</span> <span class="o">=</span> <span class="s2">&quot;./Etot.dat&quot;</span>
<span class="n">thermodata</span> <span class="o">=</span> <span class="n">nT</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span> 
<span class="n">TT</span><span class="p">,</span> <span class="n">Fmin</span><span class="p">,</span> <span class="n">celldmsminT</span><span class="p">,</span> <span class="n">alphaT</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">aT</span><span class="p">,</span> <span class="n">chi</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">,</span><span class="n">typeEtot</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">typeFvib</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">defaultguess</span><span class="o">=</span><span class="p">[</span><span class="mf">5.12374914</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">8.19314311</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>


<span class="c1"># Now start the quasi-static calculation    </span>
<span class="n">fC</span> <span class="o">=</span> <span class="s2">&quot;./elastic_constants/output_el_cons.g&quot;</span>

<span class="c1"># Read the elastic constants and compliances from files </span>
<span class="n">Cx</span><span class="p">,</span> <span class="n">Sx</span> <span class="o">=</span> <span class="n">read_elastic_constants_geo</span><span class="p">(</span><span class="n">fC</span><span class="p">,</span> <span class="n">ngeo</span><span class="p">)</span>    
<span class="n">Cxx</span> <span class="o">=</span> <span class="n">rearrange_Cx</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span><span class="n">ngeo</span><span class="p">)</span>     <span class="c1"># rearrange them in the proper order for fitting</span>

<span class="c1"># Optionally save them</span>
<span class="n">write_C_geo</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span> <span class="n">Cxx</span><span class="p">,</span> <span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fCout</span><span class="o">=</span><span class="s2">&quot;./elastic_constants/&quot;</span><span class="p">)</span>

<span class="c1"># Fit the elastic constants as a function of celldmsx</span>
<span class="n">aC</span><span class="p">,</span> <span class="n">chiC</span> <span class="o">=</span> <span class="n">fitCxx</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span> <span class="n">Cxx</span><span class="p">,</span> <span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">typeC</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">)</span>

<span class="n">T</span><span class="p">,</span> <span class="n">CT</span> <span class="o">=</span> <span class="n">fitCT</span><span class="p">(</span><span class="n">aC</span><span class="p">,</span> <span class="n">chiC</span><span class="p">,</span> <span class="n">TT</span><span class="p">,</span> <span class="n">celldmsminT</span><span class="p">,</span> <span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">typeC</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">)</span>
       
<span class="n">write_CT</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">CT</span><span class="p">,</span><span class="n">fCout</span><span class="o">=</span><span class="s2">&quot;./elastic_constants/&quot;</span><span class="p">)</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">CT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;C11 (kbar)&quot;</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">CT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;C12 (kbar)&quot;</span><span class="p">)</span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">CT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;C13 (kbar)&quot;</span><span class="p">)</span>
<span class="n">fig4</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span><span class="n">CT</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;C33 (kbar)&quot;</span><span class="p">)</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_1.png&quot;</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_2.png&quot;</span><span class="p">)</span>
<span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_3.png&quot;</span><span class="p">)</span>
<span class="n">fig4</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_4.png&quot;</span><span class="p">)</span>


<span class="c1"># plot now 4 elastic constants in the same plot</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">pCxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="mi">4</span><span class="p">))</span>
<span class="n">pCxx</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pCxx</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pCxx</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">pCxx</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Clabels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C11&quot;</span><span class="p">,</span><span class="s2">&quot;C12&quot;</span><span class="p">,</span><span class="s2">&quot;C13&quot;</span><span class="p">,</span><span class="s2">&quot;C33&quot;</span><span class="p">]</span>
<span class="n">fig5</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">pCxx</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cxx (kbar)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">Clabels</span><span class="p">)</span>
<span class="n">fig5</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure_5.png&quot;</span><span class="p">)</span>    

</pre></div>
</div>
<a class="reference internal image-reference" href="_images/figure_16.png"><img alt="_images/figure_16.png" src="_images/figure_16.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_25.png"><img alt="_images/figure_25.png" src="_images/figure_25.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_35.png"><img alt="_images/figure_35.png" src="_images/figure_35.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_44.png"><img alt="_images/figure_44.png" src="_images/figure_44.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_53.png"><img alt="_images/figure_53.png" src="_images/figure_53.png" style="width: 400px;" /></a>
</div>
<div class="section" id="numerical-issues-example-8">
<h2>Numerical issues (example 8)<a class="headerlink" href="#numerical-issues-example-8" title="Permalink to this headline">¶</a></h2>
<p>It is important to realize that the practical application of the quasi-harmonic approximation relies on fitting and minimizing the free energy as a function of volume, lattice parameters and temperature, ultimately on numerical methods. <code class="xref py py-mod docutils literal"><span class="pre">pyqha</span></code> uses numpy and scipy functions to this aim. The user must select the best methods/options for the specific system under investigation and it is always better to test, test, test...</p>
<p>The following example shows how different methods/options may lead to different sets of results. Sometimes the differences are within the target numerical precision. Sometimes the results are simply wrong because of an improper choice of the methods/options.</p>
<p>First, let&#8217;s compute some example results for a hypotetical hexagonal system, using total energy and phonon DOS for different values of <img class="math" src="_images/math/4fd6d1eaa5bdfc2402c9cd652cb8418d6a851858.png" alt="(a,c)"/> lattice parameters. We use all default values of the function <code class="xref py py-func docutils literal"><span class="pre">fitFvib()</span></code>, i.e. a quadratic polynomial for fitting the total energies, a quadratic polynomial for fitting the vibrational energies, BFGS algorithm for minimization with default options (see the documentation of scipy.optimize.minimize for more details).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">RY_KBAR</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">gen_TT</span><span class="p">,</span> <span class="n">read_Etot</span><span class="p">,</span> <span class="n">read_dos_geo</span><span class="p">,</span> <span class="n">compute_thermo_geo</span><span class="p">,</span> <span class="n">read_thermo</span><span class="p">,</span> <span class="n">rearrange_thermo</span><span class="p">,</span> <span class="n">fitFvib</span><span class="p">,</span> <span class="n">write_celldmsT</span><span class="p">,</span> <span class="n">write_alphaT</span>
<span class="kn">from</span> <span class="nn">pyqha</span> <span class="kn">import</span> <span class="n">simple_plot_xy</span><span class="p">,</span> <span class="n">plot_Etot</span><span class="p">,</span> <span class="n">plot_Etot_contour</span><span class="p">,</span> <span class="n">multiple_plot_xy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># this part is for calculating the thermodynamic properties from the dos</span>
<span class="n">fdos</span><span class="o">=</span><span class="s2">&quot;dos_files/output_dos.dat.g&quot;</span>	<span class="c1"># base name for the dos files (numbers will be added as postfix)</span>
<span class="n">fthermo</span> <span class="o">=</span> <span class="s2">&quot;thermo&quot;</span>		<span class="c1"># base name for the output files (numbers will be added as postfix)</span>

<span class="n">ngeo</span> <span class="o">=</span> <span class="mi">25</span>	<span class="c1"># this is the number of volumes for which a dos has been calculated			</span>

<span class="c1">#TT =gen_TT(1,2000)	# generate the numpy array of temperatures for which the properties will be calculated</span>
<span class="c1">#T, Evib, Fvib, Svib, Cvib, ZPE, modes = compute_thermo_geo(fdos,fthermo,ngeo,TT)</span>
<span class="c1">#nT = len(T)</span>

<span class="c1"># Alternatively, read the thermodynamic data from files if you have already</span>
<span class="c1"># done the calculations</span>
<span class="n">T1</span><span class="p">,</span> <span class="n">Evib1</span><span class="p">,</span> <span class="n">Fvib1</span><span class="p">,</span> <span class="n">Svib1</span><span class="p">,</span> <span class="n">Cvib1</span> <span class="o">=</span> <span class="n">read_thermo</span><span class="p">(</span> <span class="n">fthermo</span><span class="p">,</span> <span class="n">ngeo</span> <span class="p">)</span>
<span class="n">nT</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span> <span class="o">=</span> <span class="n">rearrange_thermo</span><span class="p">(</span> <span class="n">T1</span><span class="p">,</span> <span class="n">Evib1</span><span class="p">,</span> <span class="n">Fvib1</span><span class="p">,</span> <span class="n">Svib1</span><span class="p">,</span> <span class="n">Cvib1</span><span class="p">,</span> <span class="n">ngeo</span> <span class="p">)</span>    


<span class="n">fEtot</span> <span class="o">=</span> <span class="s2">&quot;./Etot.dat&quot;</span>
<span class="n">thermodata</span> <span class="o">=</span> <span class="n">nT</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Evib</span><span class="p">,</span> <span class="n">Fvib</span><span class="p">,</span> <span class="n">Svib</span><span class="p">,</span> <span class="n">Cvib</span> 

<span class="c1"># Fit and minimize with default options, quadratic polynomials for both Etot and Fvib, minimization method=&quot;BFGS&quot;, minoptions={&#39;gtol&#39;: 1e-5}</span>
<span class="c1">#TT, Fmin, celldmsminT, alphaT, a0, chi, aT, chiT = fitFvib(fEtot,thermodata)</span>
<span class="n">res1</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">)</span>
<span class="n">fig1</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">res1</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;a_min (a.u.)&quot;</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">res1</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">2</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;c_min (a.u.)&quot;</span><span class="p">)</span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">res1</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;alpha_xx (1/K)&quot;</span><span class="p">)</span>
<span class="n">fig4</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">res1</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">2</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;alpha_zz (1/K)&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>Running the above code and observing the results below, you can notice that the thermal expansions present some spikes. These quantities are obtained as numerical derivatives of the lattice parameters and are thus more sensitive to any numerical noise. The default convergence criterium, minoptions={&#8216;gtol&#8217;: 1e-5}, for the minimization BFGS algorithm is not sufficient to obtain good results.</p>
<a class="reference internal image-reference" href="_images/figure_17.png"><img alt="_images/figure_17.png" src="_images/figure_17.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_26.png"><img alt="_images/figure_26.png" src="_images/figure_26.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_36.png"><img alt="_images/figure_36.png" src="_images/figure_36.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_45.png"><img alt="_images/figure_45.png" src="_images/figure_45.png" style="width: 400px;" /></a>
<p>Let&#8217;s see what happens if we now systematically increase <em>gtol</em>, using the same minimization method (BFGS):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Fit and minimize with quadratic polynomials for both Etot and Fvib, minimization method=&quot;BFGS&quot;, increasing gtol</span>
<span class="n">res2</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span><span class="n">minoptions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">})</span>
<span class="n">res3</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span><span class="n">minoptions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">})</span>
<span class="n">res4</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span><span class="n">minoptions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">})</span>

<span class="c1"># plot together the 3 resulting thermal expansions</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">3</span><span class="p">))</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res2</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>	
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res3</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res4</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fig5</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;a_min (a.u.)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1e-6&quot;</span><span class="p">,</span><span class="s2">&quot;1e-7&quot;</span><span class="p">,</span><span class="s2">&quot;1e-8&quot;</span><span class="p">])</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res2</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>	
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res3</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res4</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">fig6</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;c_min (a.u.)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1e-6&quot;</span><span class="p">,</span><span class="s2">&quot;1e-7&quot;</span><span class="p">,</span><span class="s2">&quot;1e-8&quot;</span><span class="p">])</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res2</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>	
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res3</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res4</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fig7</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;alpha_xx (1/K)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1e-6&quot;</span><span class="p">,</span><span class="s2">&quot;1e-7&quot;</span><span class="p">,</span><span class="s2">&quot;1e-8&quot;</span><span class="p">])</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res2</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>	
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res3</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res4</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">fig8</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;alpha_zz (1/K)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1e-6&quot;</span><span class="p">,</span><span class="s2">&quot;1e-7&quot;</span><span class="p">,</span><span class="s2">&quot;1e-8&quot;</span><span class="p">])</span>


</pre></div>
</div>
<p>The results of the above code are shown here:</p>
<a class="reference internal image-reference" href="_images/figure_54.png"><img alt="_images/figure_54.png" src="_images/figure_54.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_62.png"><img alt="_images/figure_62.png" src="_images/figure_62.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_7.png"><img alt="_images/figure_7.png" src="_images/figure_7.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_8.png"><img alt="_images/figure_8.png" src="_images/figure_8.png" style="width: 400px;" /></a>
<p>As you can see, the thermal expansions are getting better, but there is still some noise at high temperature, even with the slowest <em>gtol</em>. If you try the &#8220;Newton-CG&#8221; algorithm you can finally get rid of these spikes.</p>
<p>Let&#8217;s see now what happens if we now use different polynomial forms for fitting, but the same minimization method (Newton-CG) and convergence criterium, minoptions={&#8216;gtol&#8217;: 1e-7}.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Refit the quadratic polynomial for Etot and quadratic for Fvib, default minimization method=&quot;Newton-CG&quot;, higher minoptions={&#39;gtol&#39;: 1e-7}</span>
<span class="n">res5</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;Newton-CG&quot;</span><span class="p">,</span><span class="n">minoptions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">})</span>

<span class="c1"># Fit the quartic polynomial for Etot and quadratic for Fvib, default minimization method=&quot;Newton-CG&quot;, higher minoptions={&#39;gtol&#39;: 1e-7}</span>
<span class="n">res6</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;Newton-CG&quot;</span><span class="p">,</span><span class="n">typeEtot</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">minoptions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">})</span>

<span class="c1"># Fit the quartic polynomial for Etot and quartic for Fvib, default minimization method=&quot;Newton-CG&quot;, higher minoptions={&#39;gtol&#39;: 1e-7}</span>
<span class="n">res7</span> <span class="o">=</span> <span class="n">fitFvib</span><span class="p">(</span><span class="n">fEtot</span><span class="p">,</span><span class="n">thermodata</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;Newton-CG&quot;</span><span class="p">,</span><span class="n">typeEtot</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">typeFvib</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">minoptions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">})</span>

<span class="c1"># plot together the 3 resulting lattice parameters and thermal expansions</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res5</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>	
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res6</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res7</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fig9</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;a_min (a.u.)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;quad+quad fit&quot;</span><span class="p">,</span><span class="s2">&quot;quart+quad fit&quot;</span><span class="p">,</span><span class="s2">&quot;quart+quart fit&quot;</span><span class="p">])</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res5</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>	
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res6</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res7</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">fig10</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;c_min (a.u.)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;quad+quad fit&quot;</span><span class="p">,</span><span class="s2">&quot;quart+quad fit&quot;</span><span class="p">,</span><span class="s2">&quot;quart+quart fit&quot;</span><span class="p">])</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res5</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>	
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res6</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res7</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fig11</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;alpha_xx (1/K)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;quad+quad fit&quot;</span><span class="p">,</span><span class="s2">&quot;quart+quad fit&quot;</span><span class="p">,</span><span class="s2">&quot;quart+quart fit&quot;</span><span class="p">])</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res5</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>	
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res6</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res7</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">fig12</span> <span class="o">=</span> <span class="n">multiple_plot_xy</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;alpha_zz (1/K)&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;quad+quad fit&quot;</span><span class="p">,</span><span class="s2">&quot;quart+quad fit&quot;</span><span class="p">,</span><span class="s2">&quot;quart+quart fit&quot;</span><span class="p">])</span>

</pre></div>
</div>
<a class="reference internal image-reference" href="_images/figure_9.png"><img alt="_images/figure_9.png" src="_images/figure_9.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_10.png"><img alt="_images/figure_10.png" src="_images/figure_10.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_111.png"><img alt="_images/figure_111.png" src="_images/figure_111.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_121.png"><img alt="_images/figure_121.png" src="_images/figure_121.png" style="width: 400px;" /></a>
<p>You can see that the fit with quadratic polynomials for both Etot and Fvib (quad+quad) gives a slightly different result, especially at 0 K, with a difference of the order of 0.2%. Some minor differences remain even when using quadratic/quartic or quartic/quartic polynomials. In general, a quartic polynomial is expected to provide a better fit, but care must be paid to avoid overfitting and the best choice also depends on the shape of your energy surface.</p>
<p>Finally, let&#8217;s see another numerical issue in quasi-harmonic calculations which is illustrated in the following code and figures:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># The minimum shifts with temperature, so does the quality of the fit (for example the chi^2)</span>
<span class="n">celldmsx</span><span class="p">,</span> <span class="n">Ex</span> <span class="o">=</span> <span class="n">read_Etot</span><span class="p">(</span><span class="n">fEtot</span><span class="p">)</span>  <span class="c1"># since the fitFvib does not return Etot data, you must read them from the original file</span>
<span class="n">iT</span><span class="o">=</span><span class="mi">1</span>                  <span class="c1"># this is the index of the temperatures array, not the temperature itself</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;T= &quot;</span><span class="p">,</span><span class="n">res7</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iT</span><span class="p">],</span><span class="s2">&quot; (K)&quot;</span><span class="p">)</span>
<span class="c1"># 2D contour plot with fitted energy (Etot+Fvib)</span>
<span class="n">fig13</span> <span class="o">=</span> <span class="n">plot_Etot_contour</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">res7</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">res7</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="n">iT</span><span class="p">])</span> 
<span class="n">iT</span><span class="o">=</span><span class="mi">1998</span>                  <span class="c1"># this is the index of the temperatures array, not the temperature itself</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;T= &quot;</span><span class="p">,</span><span class="n">res7</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iT</span><span class="p">],</span><span class="s2">&quot; (K)&quot;</span><span class="p">)</span>
<span class="c1"># 2D contour plot with fitted energy (Etot+Fvib)</span>
<span class="n">fig14</span> <span class="o">=</span> <span class="n">plot_Etot_contour</span><span class="p">(</span><span class="n">celldmsx</span><span class="p">,</span><span class="n">nmesh</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">fittype</span><span class="o">=</span><span class="s2">&quot;quartic&quot;</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">res7</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">res7</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="n">iT</span><span class="p">])</span> 
<span class="c1"># plot the chi^2 as a function of temperature</span>
<span class="n">fig15</span> <span class="o">=</span> <span class="n">simple_plot_xy</span><span class="p">(</span><span class="n">res7</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">res7</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="n">res7</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;T (K)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;chi^2&quot;</span><span class="p">)</span>   

</pre></div>
</div>
<a class="reference internal image-reference" href="_images/figure_131.png"><img alt="_images/figure_131.png" src="_images/figure_131.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_141.png"><img alt="_images/figure_141.png" src="_images/figure_141.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="_images/figure_151.png"><img alt="_images/figure_151.png" src="_images/figure_151.png" style="width: 400px;" /></a>
<p>The first two figures above show iso-contour lines for the <img class="math" src="_images/math/392117a3d7845feb9876818fc4b48344e3d1a062.png" alt="E_{tot}(a,c)+F_{vib}(a,c)"/> surface at T=1 K and T=1999 K. You can see that the minimum is shifting as expected because of thermal expansion (usually positive) and as a consequence it becomes closer to the boundary of the chosen <img class="math" src="_images/math/4fd6d1eaa5bdfc2402c9cd652cb8418d6a851858.png" alt="(a,c)"/> grid. It is important to check that the minimun does not get too close to the boundary in order to avoid a serious decrease of the fit accuracy. In any case, the <img class="math" src="_images/math/b0a677c7b64a9ce46bca897eabaf2af1c84de1a5.png" alt="\chi^2"/> of the fitting procedure is always slightly changing (usually increasing) with temperature, as shown in the last figure.</p>
<table class="docutils footnote" frame="void" id="thermo-pw" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td><a class="reference external" href="http://qeforge.qe-forge.org/gf/project/thermo_pw/">http://qeforge.qe-forge.org/gf/project/thermo_pw/</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pyqha.html" title="pyqha package"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Mauro Palumbo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5a1.
    </div>
  </body>
</html>